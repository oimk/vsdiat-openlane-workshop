# Floorplanning Basics 
The next step after synthesis describes floor planning, a step in which you define the dimensions of the chip, the location of preplaced cells, the power placement, and the pin placement. This step happens before the placement of the standard cells and after the synthesis of the RTL design into a netlist. This step makes sure that the important parts of the chips are placed down first to reduce space usage and allows the wiring downstream of the flow to not interfere with the critical components of the chip.  

For now here is some important terminology:  
--> Die: A section of a semiconductor wafer where all the functioanlity of your design is printed on. (pins, logic gates, memory, etc)  
--> Core: The main part of the die where all the logic and logic gates are printed on. This part does not contain the pins.
<img width="771" height="646" alt="image" src="https://github.com/user-attachments/assets/419e9399-cd6d-452d-abf3-7e842c5d8510" />
<figcaption>Image from VSDIAT course & taken from lecture.</figcaption>

## Step 1: Dimensions of the die 
In this step, the netlist generated by *run_synthesis* is used to find the total area taken up by the netlist. For example, in a circuit with 4 standard cells, assuming each standard cell has the dimensions of 1 unit and 1 unit in width, the total area taken up by the cells will be four square units. (We are ignoring the wires as they are in a different layer than the cells --- more on that later). Assuming that the core has a total area of 4 units, the utilization factor will be 1. The utilization factor is calculated using this formula: (total area of netlist)/(total area of die). This means that the netlist takes up 100% of the core. If the core has the length and width of 2, then the aspect ratio is 1. The aspect ratio is calculated using this formula: (Height of core)/(Width of core). The aspect ratio defines the shape of the core. If the ratio is less than one, the shape is a rectangle; if it is one, then the core is a square. 
<img width="1738" height="963" alt="image" src="https://github.com/user-attachments/assets/8de42e55-f8b3-48fb-8509-16f728b84845" /><figcaption>Image from VSDIAT course & taken from lecture.</figcaption>


## Step 2: Preplaced cell
In this step, the goal is to define the location of "Pre-placed cells". Pre-placed cells are essentially modular black boxes contain large circuit blocks that can be resued, saving space. These black blocks have an input pins and output pins that can be connected to other circuits. It saves space by not needing to implement the circuits inside the black boxes for every circuit and instead only use one black box, reducing redundancy. These cells are already designed and the placement of these cells cannot be changed later on. Thus, it is important that these cells are placed in stragetic location that maximize efficiency.
<img width="1532" height="1071" alt="image" src="https://github.com/user-attachments/assets/a271a23b-a1bc-479b-a3f2-ba0a2d875183" /><figcaption>Image from VSDIAT course & taken from lecture.</figcaption>


However, one problem comes up with these preplaced cells. Assuming that a preplaced cell is connected to a power source through a wire, because in reality wires have physical dimensions, the wire has resistance. When the preplaced cells are far away enough from the power source, the capacitors that determine a 1 or a 0 may not have enough power to guarantee a 1 or a 0 due to the resistance in the wire that decreases the available power. Thus, to solve this problem, decoupling capacitors are placed close to the cells that decouple the cells from the power source. These decoupling capacitors are able to provide enough power, due to their closer distance, to guarantee a 1 or a 0. These capacitors are able to store energy from the power source. 
<img width="1373" height="883" alt="image" src="https://github.com/user-attachments/assets/3184eacf-c351-4b7d-8d49-7d4ad0100439" /><figcaption>Image from VSDIAT course & taken from lecture.</figcaption>

## Step 3: Pin placement and Power Planning 
In this step, the goal is get the power distrubtion network and the pin interfaces ready so that when we place down the standard cell, they won't interfer with the pins nor the power grid. Given this scenario where mutiple capacitors are charging up to a 1 and mutiple capacitors are discharing down to a 0 due to an input, the power source (VDD) will be not be able to supply enough power while the ground (VSS) will have too much power. This will create a voltage drop and a voltage bump respectively. If the voltage drop decreases the voltage enough that the capacitors are not able to fully charge to a 1 or if the voltage bump provides too much voltage that the capacitors are not able to determine a 0, then there will be problems and the 1 and 0 cannot be propertly defined. To solve this problem, mutiple power and ground networks run horizontally and vertically respectively. This ensures that there is enough power to for all the capacitors to charge to a 1 and enough drainage so that all capacitors can discharge to a 0. For the input and output pins, they can be placed in any directionality but in this case they are place left to right respectively and place in the order to maximize efficiency. One specific input could be the clock imput. Because the clock input continuously drive the cells and make sure they sync, the clock inputs and output needs to have the path of least resistance and a bigger wire to let more crruent to flow through.  
<img width="1711" height="918" alt="image" src="https://github.com/user-attachments/assets/0ff8ae66-1bb4-49ef-b257-58f2c4d0ed91" /><figcaption>Image from VSDIAT course & taken from lecture.</figcaption>
<img width="1777" height="928" alt="image" src="https://github.com/user-attachments/assets/6592bdf7-bda1-4a99-8bb8-28f2ceb07b6e" /><figcaption>The above is the pin placement for a demo chip. Image from VSDIAT course & taken from lecture.</figcaption>

## Commands to run placement  
--> Step 1: Go the file in which you have compeleted synthesis. One the command line. type run_floorplan.  
To see the modificiation and the design applyed to the command run_synthesis, go to the openlane dir and check on the README.md file for the meaning of the configuration variables and go to the floorplan.tcl file to see the specific default configurations applied. 
To see the specific modification applied to the design after run_synthesis based on your design, see the config.tcl file in the your specific design folder or see the (specific PDK design name)_config.tcl (not the config.tcl file itself) for the highest level modification that is used in run_floorplan.

--> Step 2: We can use floorplan using this command
```bash 
magic -T /home/vsduser/Desktop/work/tools/openlane_working_dir/pdks/sky130A/libs.tech/magic/sky130A.tech lef read ../../tmp/merged.lef def read picorv32a.floorplan.def &
```
The above is specific to my directory so change the paths to the file with your own specific path.  

The output should result in this:
<img width="843" height="917" alt="image" src="https://github.com/user-attachments/assets/b5368229-b285-4aec-8cb8-54682cfaf142" />
<figcaption> Use s to select, v to center, z to zoom in, and shift z to zoom out. To zoom to a specific location, first press the left mouse key and then the right mouse key. </figcaption>
At the bottom right of the chip, we see the unplaced standard cells. You can use hover over the object and press s to select the object and in the white magic terminal type what to determine what is it. 
<img width="857" height="842" alt="image" src="https://github.com/user-attachments/assets/788323b2-f5d9-4309-908a-d7cc892045ef" />

# Placement of standard cells 
In this step, the goal is to convert what we have in the netlist into physical cells that are in the core of the die. This steps happens after run_floorplan and happens after every critical component is placed. This step places the remaining logic gates that are required to give the chip functionality. (Note: Even after this step is completed, the wiring has not been done yet so the chip is not yet functional).

For now here is some important terminology:  
--> Library: is a database that specifices all the logic gates used in to give functionality to a chip. The library also contains infomration about the timing specification of differnet logic gates and different versions of the same logic gates with the same functionality but different timing specifications. 
<img width="946" height="455" alt="image" src="https://github.com/user-attachments/assets/5406000d-a2b8-4267-a83b-381bbf62d2aa" />


## Step 1: Netlist --> Physical Cells 
This step convert a netlist into physicals cells through the library. Each gate in the netlist (AND gate, Or gate, etc.) is given a specific shape and size through the library and readyto be placed down into the core of the die.

## Step 2: Optimize placing 
This step optimizes the placement of cells that connects each circuit to it's respective input and output based on the netlist. Some cells are placed close to each other than others because their circuits may require higher clock speeds. It is important to note that the farther away a cell is from it's input or output the more the signal gets distorted. Thus, wire length and capacitance are estimated (without placing them down) and are used to determine the placement of optional repeater. Repeaters (buf in the diagram below) lowers the distance a signal has to travel and maintains it's original signal strength so that the some circuits can function propertly. 
<img width="1919" height="964" alt="image" src="https://github.com/user-attachments/assets/5b438f4d-b72d-4f44-a963-a3e788cf1e67" /><figcaption>Image from VSDIAT course & taken from lecture. Ignore arrows</figcaption>



